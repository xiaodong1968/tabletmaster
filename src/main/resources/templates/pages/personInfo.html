<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name=renderer content=webkit>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!--[if lt IE 9]>
    <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
    <![endif]-->

    <meta name="_csrf" th:content="${_csrf.token}">
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
    <meta charset="UTF-8">
    <link th:href="@{/third/css/bootstrap.min.css}" rel="stylesheet">
    <link th:href="@{/third/font-awesome-4.7.0/css/font-awesome.css}" rel="stylesheet">
    <link th:href="@{/third/css/animate.css}" rel="stylesheet">
    <link th:href="@{/third/DataTables/datatables.min.css}" rel="stylesheet">
    <link th:href="@{/third/lib/layui/css/layui.css}" rel="stylesheet" type="text/css">
    <link th:href="@{/third/jtree/css/style.min.css}" rel="stylesheet" type="text/css"></link>
    <link th:href="@{/third/jtree/css/custom.css}" rel="stylesheet" type="text/css"></link>
    <link th:href="@{/third/jtree/css/awesome-bootstrap-checkbox.css}" rel="stylesheet" type="text/css"></link>
    <link th:href="@{/third/css/bootstrap_modify.css}" rel="stylesheet" type="text/css"></link>
    <title>个人信息</title>
    <style>
        body{
            background: white;
            overflow: auto;
        }
    </style>
</head>
<body>
<div class="wrapper wrapper-content animated fadeInRight">
    <div class="row">
        <div class="col-sm-12">
            <div class="ibox float-e-margins">
                <div class="ibox-content">
                    <form method="post" class="form-horizontal" id=editUserForm>
                        <div class="hr-line-dashed"></div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">用户名称：</label>
                            <div class="col-sm-7">
                                <input type="hidden" id="userId" th:value="${session.userinfo.id}" name="id">
                                <input type="text" class="form-control" readonly th:value="${session.userinfo.username}">
                            </div>
                        </div>
                        <div class="hr-line-dashed"></div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">真实姓名：</label>
                            <div class="col-sm-7">
                                <input type="text" class="form-control" readonly id="realname" th:value="${session.userinfo.realname}">
                            </div>
                        </div>
                        <div class="hr-line-dashed"></div>
                        <div class="form-group">
                            <div class="col-sm-9 text-center" >
                                <label class="btn btn-info" onclick="changePass()" style="background: #ef5e4f">修改密码</label>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<!--<div class="wrapper wrapper-content animated fadeInRight">
    <div class="row">
        <div class="col-sm-12">
            <div class="ibox float-e-margins">
                <div class="ibox-content">
                    <form method="post" class="form-horizontal" id=editUserForm>
                        <div class="hr-line-dashed"></div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">用户名称：</label>
                            <div class="col-sm-7">
                                <input type="hidden" id="userId" th:value="${session.userinfo.id}" name="id">
                                <input type="text" class="form-control" readonly th:value="${session.userinfo.username}">
                            </div>
                        </div>
                        <div class="hr-line-dashed"></div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">真实姓名：</label>
                            <div class="col-sm-7">
                                <input type="text" class="form-control" readonly id="realname" th:value="${session.userinfo.realname}">
                            </div>
                        </div>
                        <div class="hr-line-dashed"></div>
                        <div class="form-group">
                            <div class="col-sm-9 text-center" >
                                <label class="btn btn-info" onclick="changePass()" style="background: #ef5e4f">修改密码</label>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>-->
<!-- 公共尾部开始 -->
<!-- 公共尾部开始 -->

<script th:src="@{/third/js/jquery.min.js}" type="text/javascript"></script>
<script th:src="@{/third/js/bootstrap.min.js}" type="text/javascript"></script>
<script th:src="@{/third/js/jquery.metisMenu.js}" type="text/javascript"></script>
<script th:src="@{/third/js/hAdmin.js}" type="text/javascript"></script>
<script th:src="@{/third/lib/layui/layui.all.js}" type="text/javascript"></script>
<script th:src="@{/third/js/jquery.validate.min.js}" type="text/javascript"></script>
<script th:src="@{/third/js/message_zh.min.js}" type="text/javascript"></script>
<script th:src="@{/third/js/validate_default.js}" type="text/javascript"></script>
<script th:src="@{/third/DataTables/datatables.min.js}" type="text/javascript"></script>
<script th:src="@{/third/js/jquery.slimscroll.min.js}" type="text/javascript"></script>
<script th:src="@{/third/js/global.js}" type="text/javascript"></script>
<script th:src="@{/third/js/sock.js}" type="text/javascript"></script>
<script th:src="@{/third/js/jquery.cookie.js}" type="text/javascript"></script>
<script th:src="@{/third/js/stomp.js}" type="text/javascript"></script>
<script th:src="@{/third/jtree/js/jstree.min.js}" type="text/javascript"></script>
<script th:src="@{/third/js/jquery.SuperSlide.2.1.3.js}" type="text/javascript"></script>

<script th:src="@{/third/js/jquery.validate.min.js}" type="text/javascript"></script>
<script th:src="@{/third/js/layui.js}" type="text/javascript"></script>
<script th:src="@{/third/js/validate_default.js}" type="text/javascript"></script>
<!-- 公共尾部结束 -->
<script>
    //基本资料和修改密码切换
    jQuery(".basic").slide({
        titCell: ".basic_title li",
        mainCell: ".basic_div",
        effect: "fade",
        trigger: "click",
    });

    //上传头像
    layui.use(['upload', 'element', 'layer'], function () {
        var $ = layui.jquery
            , upload = layui.upload
            , element = layui.element
            , layer = layui.layer;
        //课堂图片上传
        var uploadInst = upload.render({
            elem: '#test1'
            , url:'uploadImage'
            , headers:{"X-CSRF-TOKEN":$("#token").val()}
            , before: function (obj) {
                //预读本地文件示例，不支持ie8
                obj.preview(function (index, file, result) {
                    $('#demo1').attr('src', result); //图片链接（base64）
                });

                element.progress('demo', '0%'); //进度条复位
                layer.msg('上传中', {icon: 16, time: 0});
            }
            , done: function (res) {
                //如果上传失败
                if (res.code == (-1)) {
                    return layer.msg('上传失败');
                }
                // //上传成功的一些操作
                $('#headImage').val(res.data.store)
                $('#demoText').html(''); //置空上传失败的状态
            }
            , error: function () {
                //演示失败状态，并实现重传
                var demoText = $('#demoText');
                demoText.html('<span style="color: #FF5722;">上传失败</span> <a class="layui-btn layui-btn-xs demo-reload">重试</a>');
                demoText.find('.demo-reload').on('click', function () {
                    uploadInst.upload();
                });
            }
            //进度条
            , progress: function (n, elem, e) {
                element.progress('demo', n + '%'); //可配合 layui 进度条元素使用
                if (n == 100) {
                    layer.msg('上传完毕', {icon: 1});
                }
            }
        });



    });


    function changePass() {
        layer.prompt({title: '请输入新的密码', formType: 1}, function (pass1, index) {
            if (pass1 == '') {
                layer.msg("新密码不能为空!");
                return;
            }
            if (pass1.length > 15) {
                layer.msg("新密码太长了！");
                return;
            }
            if (pass1.length < 6) {
                layer.msg("新密码太短了！");
                return;
            }
            layer.close(index);
            layer.prompt({title: '请再次输入的新密码', formType: 1}, function (pass2, index) {
                if (pass1 != pass2) {
                    layer.msg("两次密码不一致!");
                    return;
                } else {
                    $.ajax({
                        url: "changeCurrentUserPass",
                        type: 'post',
                        data: {"passwd": pass2},
                        success: function (data) {
                            if (data == 1) {
                                layer.msg("修改成功!下次登录将启用新密码！！！");
                                layer.close(index);
                                return;
                            }
                            layer.close(index);
                            layer.msg("修改失败!");
                        }
                    })
                }
            });
        });
        $.ajax({
            url: 'editUser',
            type: 'post',
            data: $("#editUserForm").serialize(),
            traditional: true,
            success: function (data) {
                if (data == -1) {
                    layer.msg("该用户已存在");
                    return;
                }
                layer.msg("修改成功", {
                        icon: 1,
                        time: 2000
                    },
                    function () {
                        var index = parent.layer.getFrameIndex(window.name);
                        parent.layer.close(index);
                    });
            }
        });
    }

    //监听表单提交(用户编辑)
    layui.use('form', function () {
        var form = layui.form;

        //提交
        form.on('submit(demo1)', function (data) {
            $.ajax({
                url: 'editUser',
                type: 'post',
                data: data.field,
                traditional: true,
                success: function (data) {
                    if (data == -1) {
                        layer.msg("该用户已存在");
                        return;
                    }
                    layer.msg("修改成功", {
                            icon: 1,
                            time: 2000
                        },
                        function () {
                            var index = parent.layer.getFrameIndex(window.name);
                            parent.layer.close(index);
                        });
                }
            });
            return false;
        });
    });

</script>
</body>
</html>