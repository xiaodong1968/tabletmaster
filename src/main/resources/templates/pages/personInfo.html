<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name=renderer  content=webkit>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!--[if lt IE 9]>
    <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
    <![endif]-->
    <meta name="_csrf" th:content="${_csrf.token}">
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
    <meta charset="UTF-8">
    <link th:href="@{/third/css/bootstrap.min.css}" rel="stylesheet">
    <link th:href="@{/third/font-awesome-4.7.0/css/font-awesome.css}" rel="stylesheet">
    <link th:href="@{/third/css/animate.css}" rel="stylesheet">
    <link th:href="@{/third/DataTables/datatables.min.css}" rel="stylesheet">
    <link th:href="@{/third/lib/layui/css/layui.css}" rel="stylesheet" type="text/css">
    <link th:href="@{/third/jtree/css/style.min.css}" rel="stylesheet" type="text/css"></link>
    <link th:href="@{/third/jtree/css/custom.css}" rel="stylesheet" type="text/css"></link>
    <link th:href="@{/third/jtree/css/awesome-bootstrap-checkbox.css}" rel="stylesheet" type="text/css"></link>
    <link th:href="@{/third/css/bootstrap_modify.css}" rel="stylesheet" type="text/css"></link>
    <title>个人信息</title>
    <style>
        body{
            background: white;
            overflow: auto;
        }
    </style>
</head>
<body>
<div class="wrapper wrapper-content animated fadeInRight">
    <div class="row">
        <div class="col-sm-12">
            <div class="ibox float-e-margins">
                <div class="ibox-content">
                    <form method="post" class="form-horizontal" id=editUserForm>
                        <div class="hr-line-dashed"></div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">用户名称：</label>
                            <div class="col-sm-7">
                                <input type="hidden" id="userId" th:value="${session.userinfo.id}" name="id">
                                <input type="text" class="form-control" readonly th:value="${session.userinfo.username}">
                            </div>
                        </div>
                        <div class="hr-line-dashed"></div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">真实姓名：</label>
                            <div class="col-sm-7">
                                <input type="text" class="form-control" readonly id="realname" th:value="${session.userinfo.realname}">
                            </div>
                        </div>
                        <div class="hr-line-dashed"></div>
                        <div class="form-group">
                            <div class="col-sm-9 text-center" >
                                <label class="btn btn-info" onclick="changePass()" style="background: #ef5e4f">修改密码</label>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- 公共尾部开始 -->
<!-- 公共尾部开始 -->
<script th:src="@{/third/js/jquery.min.js}" type="text/javascript"></script>
<script th:src="@{/third/js/bootstrap.min.js}" type="text/javascript"></script>
<script th:src="@{/third/js/jquery.metisMenu.js}" type="text/javascript"></script>
<script th:src="@{/third/js/hAdmin.js}" type="text/javascript"></script>
<script th:src="@{/third/lib/layui/layui.all.js}" type="text/javascript"></script>
<script th:src="@{/third/js/jquery.validate.min.js}" type="text/javascript"></script>
<script th:src="@{/third/js/message_zh.min.js}" type="text/javascript"></script>
<script th:src="@{/third/js/validate_default.js}" type="text/javascript"></script>
<script th:src="@{/third/DataTables/datatables.min.js}" type="text/javascript"></script>
<script th:src="@{/third/js/jquery.slimscroll.min.js}" type="text/javascript"></script>
<script th:src="@{/third/js/global.js}" type="text/javascript"></script>
<script th:src="@{/third/js/sock.js}" type="text/javascript"></script>
<script th:src="@{/third/js/jquery.cookie.js}" type="text/javascript"></script>
<script th:src="@{/third/js/stomp.js}" type="text/javascript"></script>
<script th:src="@{/third/jtree/js/jstree.min.js}" type="text/javascript"></script>
<!-- 公共尾部结束 -->
<script>
    function changePass(){
        layer.prompt({title: '请输入新的密码', formType: 1}, function(pass1, index){
            if(pass1==''){
                layer.msg("新密码不能为空!");
                return ;
            }
            if(pass1.length>15){
                layer.msg("新密码太长了！");
                return ;
            }
            if(pass1.length<6){
                layer.msg("新密码太短了！");
                return ;
            }
            layer.close(index);
            layer.prompt({title: '请再次输入的新密码', formType: 1}, function(pass2, index){
                if(pass1!=pass2){
                    layer.msg("两次密码不一致!");
                    return ;
                }else{
                    $.ajax({
                        url:"changeCurrentUserPass",
                        type: 'post',
                        data:{"passwd":pass2},
                        success:function (data) {
                            if(data==1){
                                layer.msg("修改成功!");
                                layer.close(index);
                                return ;
                            }
                            layer.close(index);
                            layer.msg("修改失败!");
                        }
                    })
                }
            });
        });
        $.ajax({
            url:'editUser',
            type:'post',
            data: $("#editUserForm").serialize(),
            traditional:true,
            success:function(data){
                if(data==-1){
                    layer.msg("该用户已存在");
                    return ;
                }
                layer.msg("修改成功",{
                        icon:1,
                        time:2000
                    },
                    function(){
                        var index = parent.layer.getFrameIndex(window.name);
                        parent.layer.close(index);
                    });
            }
        }) ;
    }

</script>
</body>
</html>