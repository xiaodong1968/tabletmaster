<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name=renderer  content=webkit>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!--[if lt IE 9]>
    <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
    <![endif]-->
    <meta name="_csrf" th:content="${_csrf.token}">
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
    <meta charset="UTF-8">
    <link th:href="@{/third/css/bootstrap.min.css}" rel="stylesheet">
    <link th:href="@{/third/font-awesome-4.7.0/css/font-awesome.css}" rel="stylesheet">
    <link th:href="@{/third/css/animate.css}" rel="stylesheet">
    <link th:href="@{/third/DataTables/datatables.min.css}" rel="stylesheet">
    <link th:href="@{/third/lib/layui/css/layui.css}" rel="stylesheet" type="text/css">
    <link th:href="@{/third/jtree/css/style.min.css}" rel="stylesheet" type="text/css"></link>
    <link th:href="@{/third/jtree/css/style.css}" rel="stylesheet" type="text/css"></link>
    <link th:href="@{/third/jtree/css/custom.css}" rel="stylesheet" type="text/css"></link>
    <link th:href="@{/third/jtree/css/awesome-bootstrap-checkbox.css}" rel="stylesheet" type="text/css"></link>
    <link th:href="@{/third/css/bootstrap_modify.css}" rel="stylesheet" type="text/css"></link>
    <title>角色管理</title>
    <style>
        .dir_nav{
            text-align: left;
            padding: 5px;
            background: #d5e1da;
            color: #363333;
            height: 35px;
            line-height: 25px;
        }
        .dir_nav_label{
            cursor: pointer;
            font-size: 16px;
        }
        .dirs{
            font-size: 14px;
        }
        #copyTemp{
            position: absolute;
            left: 45%;
            top:55%;
            width: 70px;
            height: 70px;
            background: rgba(51,51,51,0.8);
            text-align: center;
            z-index: 9999999999999;
            color: white;
            border-radius: 70px;
            line-height: 70px;
            font-size: 16px;
        }
        #copyTemp  label{
            cursor: pointer;
        }
        .mvchoice{
            background: #cbedb6;
            border: 1px dotted #ebe4e4;
        }
        .childMenu{
            position: absolute;
            width: 100%;
            height: auto;
            left: 0px;
            top: 25%;
            background: rgba(51, 51, 51, 0.8);
            border-radius: 10px;
            color: white;
            z-index: 999999999999;
        }
        .childMenu ul li{
            padding: 5px;
            border-bottom: 1px solid seagreen;
        }

    </style>
</head>
<body style="margin:0px;padding:0px">
<div class="wrapper wrapper-content animated fadeInRight" style="margin:0px;padding:0px">
    <div class="row" style="margin:0px;padding:0px">
        <div class="col-sm-12" style="margin:0px;padding:0px">
            <div class="ibox" style="margin:0px;padding:0px">
                <div class="ibox-content" style="margin:0px;padding:0px">
                    <div id="myContent" style="overflow: auto;height: 795px;margin:0px;padding:0px" >
                        <div class="dir_nav">
                            <input id="rootDir" type="hidden" th:value="${mydir.id}">
                            <input id="currentDir" type="hidden" th:value="${mydir.id}">
                            <input id="currentParentDir" type="hidden" th:value="${mydir.parentId}">
                            <label  class="dir_nav_label" th:onclick="openDir(-1)"><i class="fa fa-arrow-left "></i></label>
                            &nbsp;
<!--                            <label  class="dir_nav_label"  th:onclick="openDir(-2)"><i class="fa fa-arrow-right"></i></label>-->
<!--                            &nbsp;-->
                            <i class="fa fa-desktop"></i>
                            <label class="dirs"><a th:onclick="openDir([[${mydir.id}]])" th:text="${currentUser}" style="color: red"> </a></label>
                        </div>
                    <!--我的网盘-->
                        <!--个人空间如果尚未被初始化-->
                        <div th:unless="(${mydir.child_file_total}+${mydir.child_total})>0" id="nullspace" style="text-align: center;margin: 60px">
                            <i class="layui-icon layui-icon-404" style="font-size:300px"></i>
                            <br/>
                            <label style="color: #d76a6a;font-size: 16px">你还未上传任何文件哦！开始上传第一个文件吧。</label>
                        </div>
                        <!--个人空间如果已经被初始化-->
                        <div id="dirspace">
                            <div class='myfolderWrap' th:each="dir:${dm.dirs}">
                                <input type="hidden" th:value="${dir.id}">
                                <input type="hidden" th:value="${dir.lockDir}">
                                <i class="fa  fa-folder myfolder"  th:if="${dir.shareToGroup}">
                                    <i class="fa fa-share-alt shareicon" ></i>
                                </i>
                                <i class="fa fa-folder myfolder" th:unless="${dir.shareToGroup}"></i>
                                <br/><label th:text="${dir.name}"></label>
                                <div class="childMenu" style="display:none">
                                    <ul>
                                        <li th:onclick="openDir([[${dir.id}]])">打开</li>
                                    </ul>
                                </div>
                            </div>
                            <div class='myfolderWrap' th:each="file:${dm.files}">
                                <input type="hidden" th:value="${file.id}">
                                <input type="hidden" th:value="${file.type}">
                                <input type="hidden" th:value="${file.lockFile}">
                                <label th:if="${file.type}==0" style="font-size: 70px;color:#d76b6b;cursor:pointer"><i class="fa fa-file-photo-o"></i></label>
                                <label th:if="${file.type}==1" style="font-size: 70px;color:#d76b6b;cursor:pointer"><i class="fa fa-file-zip-o-o"></i></label>
                                <label th:if="${file.type}==2" style="font-size: 70px;color:#d76b6b;cursor:pointer"><i class="fa fa-file-pdf-o"></i></label>
                                <label th:if="${file.type}==3" style="font-size: 70px;color:#6b91d7;cursor:pointer"><i class="fa fa-file-word-o"></i></label>
                                <label th:if="${file.type}==4" style="font-size: 70px;color:#cbc75e;cursor:pointer"><i class="fa fa-file-excel-o"></i></label>
                                <label th:if="${file.type}==5" style="font-size: 70px;color:#fb2222;cursor:pointer"><i class="fa fa-file-powerpoint-o"></i></label>
                                <label th:if="${file.type}==6" style="font-size: 70px;color:#d76b6b;cursor:pointer"><i class="fa fa-file-text-o"></i></label>
                                <label th:if="${file.type}==7" style="font-size: 70px;color:#d76b6b;cursor:pointer"><i class="fa fa-file-video-o"></i></label>
                                <br/>
                                <label th:text="${file.name}"></label>
                                <div class="childMenu" style="display:none">
                                    <ul>
                                        <li th:onclick="readFile([[${file.id}]],[[${file.type}]])">打开</li>
                                        <li><a style="color:white;display: block" th:href="|downLoadFile?fileId=${file.id}|">下载</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!---->
                </div>
            </div>
        </div>
    </div>
</div>
<!-- 公共尾部开始 -->
<script th:src="@{/third/js/jquery.min.js}" type="text/javascript"></script>
<script th:src="@{/third/js/bootstrap.min.js}" type="text/javascript"></script>
<script th:src="@{/third/js/jquery.metisMenu.js}" type="text/javascript"></script>
<script th:src="@{/third/js/hAdmin.js}" type="text/javascript"></script>
<script th:src="@{/third/lib/layui/layui.all.js}" type="text/javascript"></script>
<script th:src="@{/third/js/jquery.validate.min.js}" type="text/javascript"></script>
<script th:src="@{/third/js/message_zh.min.js}" type="text/javascript"></script>
<script th:src="@{/third/js/validate_default.js}" type="text/javascript"></script>
<script th:src="@{/third/DataTables/datatables.min.js}" type="text/javascript"></script>
<script th:src="@{/third/js/jquery.slimscroll.min.js}" type="text/javascript"></script>
<script th:src="@{/third/js/global.js}" type="text/javascript"></script>
<script th:src="@{/third/js/sock.js}" type="text/javascript"></script>
<script th:src="@{/third/js/jquery.cookie.js}" type="text/javascript"></script>
<script th:src="@{/third/js/stomp.js}" type="text/javascript"></script>
<!-- 公共尾部结束 -->
<script>
    var menuId=$("#menuId").val();
    $("#searchForm").on("submit",function(){
        return false;
    });
    //渲染文件
    function renderFileHtml(data){
        $("#nullspace").hide();
        var htm;
        var  icon="fa fa-file-pdf-o";
        var color="red";
        htm="<div class='myfolderWrap'><input type='hidden' value='"+data.id+"'><input type='hidden' value='"+data.type+"'><input type='hidden' value='"+data.lockFile+"'>";
        switch (data.type) {
            case 0:
                icon="fa fa-file-photo-o";
                color="#d76b6b";
                break;
            case 1:
                icon="fa fa-file-zip-o-o";
                color="#d76b6b";
                break;
            case 2:
                icon="fa fa-file-pdf-o";
                color="#d76b6b";
                break;
            case 3:
                icon="fa fa-file-word-o";
                color="#6b91d7";
                break;
            case 4:
                icon="fa fa-file-excel-o";
                color="#cbc75e";
                break;
            case 5:
                icon="fa fa-file-powerpoint-o";
                color="#fb2222";
                break;
            case 6:
                icon="fa fa-file-text-o";
                color="#d76b6b";
                break;
            case 7:
                icon="fa fa-file-video-o";
                color="#d76b6b";
                break;
        }
        htm=htm+"<label style='font-size: 70px;color:"+color+";cursor:pointer'><i class='"+icon+"'></i></label><br/>";
        htm=htm+"<label>"+data.name+"</label>";
        $(htm).appendTo($("#dirspace"));
        $(".myfolderWrap").hover(function(){
            if($(this).find("div[class='childMenu']").length!=0){
                $(this).find("div[class='childMenu']").show();
                return ;
            }
            var htm2="<div class='childMenu'><ul>" +
                "<li onclick='readFile("+data.id+","+data.type+")'>打开</li>" +
                "<li><a style='color:white;display: block' href='downLoadFile?fileId="+data.id+"'>下载</a></li></ul></div>";
            $(htm2).appendTo($(this));
        },function () {
            $(this).find("div[class='childMenu']").hide();
        });
    }
    //渲染文件夹
    function renderHtml(data){
        $("#nullspace").hide();
        var htm;
        if(data.id==$("#copyTemp_id").val()){
            htm="<div class='myfolderWrap mvchoice'><input type='hidden' value='"+data.id+"'><input type='hidden' value='"+data.lockDir+"'>";
            if(data.shareToGroup){
            htm=htm+"<i class='fa fa-folder myfolder'><i class='fa fa-share-alt shareicon' ></i></i>";
            }else{
                htm=htm+"<i class='fa fa-folder myfolder'></i>";
            }
            htm=htm+"<br/><label>"+data.name+"</label></div>";
        }
        else{
            htm="<div class='myfolderWrap'><input type='hidden' value='"+data.id+"'><input type='hidden' value='"+data.lockDir+"'>";
            if(data.shareToGroup){
                htm=htm+"<i class='fa fa-folder myfolder'><i class='fa fa-share-alt shareicon' ></i></i>";
            }else{
                htm=htm+"<i class='fa fa-folder myfolder'></i>";
            }
            htm=htm+"<br/><label>"+data.name+"</label></div>";
        }
        $(htm).appendTo($("#dirspace"));
        $(".myfolderWrap").hover(function(){
            if($(this).find("div[class='childMenu']").length!=0){
                $(this).find("div[class='childMenu']").show();
                return ;
            }
            var htm2="<div class='childMenu'><ul>" +
                "<li onclick='openDir("+data.id+")'>打开</li>" +
                "</ul></div>";
            $(htm2).appendTo($(this));
        },function () {
            $(this).find("div[class='childMenu']").hide();
        });
    }
    $(".myfolderWrap").hover(function(){
        if($(this).find("div[class='childMenu']").length!=0){
            $(this).find("div[class='childMenu']").show();
        }
    },function () {
        $(this).find("div[class='childMenu']").hide();
    });
    //打开目录
    function openDir(id,navclick){
            if($("#copyTemp_id").val()==id){
                layer.msg("不可以哦！");
                return ;
            }
            var model=0;
            var rootId=$("#rootDir").val();
            if(id==rootId){
                model=2;//如果是直接点击用户根目录
            }
            if(navclick!=null){
                model=3;//如果是直接点击导航中的目录
            }
            if(navclick!=null&&navclick=="refresh"){
                model=4;//如果是刷新当前目录
            }
            if(id==-1){
                id= $("#currentParentDir").val();
                if(id==rootId){//如果向上翻的是根目录
                    model=2;
                }
                else{
                    model=1;//如果是向上翻目录
                }
            }
            if(id==-2){
                id= $("#currentDir").val();

            }
            if(id==0){//如果已经是根目录
               return ;
            }
            $.ajax({
                url:'openDir',
                data:{"parentId":id},
                success:function(data){
                    $("#currentDir").val(id);
                    $("#currentParentDir").val(data.parentId);
                    if(model==1){
                       var index= $(".dirs").html().lastIndexOf("》")-8;
                       var restr= $(".dirs").html().substring(0,index);
                        $(".dirs").html(restr);
                    }
                    if(model==2){
                        var index= $(".dirs").html().indexOf("》");
                        if(index==-1){
                            return ;
                        }
                        var restr= $(".dirs").html().substring(0,index);
                        $(".dirs").html(restr);
                    }
                    if(model==3){
                        $(navclick).parent().nextAll().remove();
                    }
                    if(model==0){
                        var htm="<label> 》<a onclick='openDir("+id+",this)'>"+data.currentName+"</a></label>";
                        $(htm).appendTo($(".dirs"));
                    }
                    $("#dirspace").children().remove();
                    for(var i=0;i<data.dirs.length;i++){
                         renderHtml(data.dirs[i]);
                    }
                    for(var i=0;i<data.files.length;i++){
                        renderFileHtml(data.files[i]);
                    }
                }
            })
    }



    //读取文件
    function readFile(fileId,fileType){
        if(fileType=="2"||fileType=="3"||fileType=="4"||fileType=="5"||fileType=="6"){
            var addGroup = layer.open({
                type : 2,
                title : "文件预览",
                content : "readFile/"+fileId,
                end : function() {

                }
            });
            layer.full(addGroup);
        }
        else if(fileType==0){
            var addGroup = layer.open({
                type : 2,
                title : "文件预览",
                content : "playMediaDialog?fileId="+fileId+"&mediaType=0",
                end : function() {

                }
            });
            layer.full(addGroup);
        }
        else if(fileType==7){
            var addGroup = layer.open({
                type : 2,
                title : "文件预览",
                content : "playMediaDialog?fileId="+fileId+"&mediaType=1",
                end : function() {

                }
            });
            layer.full(addGroup);
        }
        else{
            layer.msg("该类型文件暂不支持预览，请下载");
        }

    }
</script>
</body>
</html>